# iWorkr â€” Cross-Module Persistence Audit Report

> **Generated**: 2026-02-17T01:08:25.475Z
> **Scope**: All 11 modules
> **Total Findings**: 38
> **Focus**: Data persistence â€” "disappears on refresh" bugs

---

## Executive Summary

| Category | Count |
|----------|-------|
| ðŸ”´ CRITICAL (data loss) | 0 |
| ðŸŸ  WARNING | 1 |
| ðŸŸ¢ PASS | 37 |

## Module Status Matrix

| Module | Status | Issue Count | Summary |
|--------|--------|-------------|---------|
| Dashboard | ðŸŸ¢ WORKING | 0C / 0W / 2P | All actions persist to DB |
| Jobs | ðŸŸ¢ WORKING | 0C / 0W / 4P | All actions persist to DB |
| Clients | ðŸŸ¢ WORKING | 0C / 0W / 3P | All actions persist to DB |
| Finance | ðŸŸ¢ WORKING | 0C / 0W / 5P | All actions persist to DB |
| Assets | ðŸŸ¢ WORKING | 0C / 0W / 4P | All actions persist to DB |
| Schedule | ðŸŸ¢ WORKING | 0C / 0W / 2P | All actions persist to DB |
| Team | ðŸŸ¢ WORKING | 0C / 0W / 4P | All actions persist to DB |
| Automations | ðŸŸ¢ WORKING | 0C / 0W / 4P | All actions persist to DB |
| Integrations | ðŸŸ  PARTIAL | 0C / 1W / 4P | 1 minor issue(s) |
| Forms | ðŸŸ¢ WORKING | 0C / 0W / 2P | All actions persist to DB |
| Inbox | ðŸŸ¢ WORKING | 0C / 0W / 2P | All actions persist to DB |
| Network | ðŸŸ¢ WORKING | 0C / 0W / 1P | All actions persist to DB |

---

## ðŸ”´ CRITICAL â€” Data Loss on Refresh

These actions update the UI but **never write to the database**. Changes vanish on page refresh.

---

## Remediation Prescription

### Jobs Module (3 critical fixes)

| Action | Current (Local-Only) | Required (Server-Backed) | Files |
|--------|---------------------|-------------------------|-------|
| Update job fields | `updateJob(id, patch)` | `updateJobServer(id, patch)` â†’ calls `updateJobAction` | `jobs/[id]/page.tsx` |
| Delete job | `deleteJob(id)` | `deleteJobServer(id)` â†’ calls `deleteJobAction` | `jobs/page.tsx`, `jobs/[id]/page.tsx` |
| Toggle subtask | `toggleSubtask(id, subId)` | `toggleSubtaskServer(id, subId)` â†’ calls `toggleSubtaskAction` | `jobs/[id]/page.tsx` |

### Clients Module (2 critical fixes)

| Action | Current (Local-Only) | Required (Server-Backed) | Files |
|--------|---------------------|-------------------------|-------|
| Update client (tags) | `updateClient(id, patch)` | `updateClientServer(id, patch)` â†’ calls `updateClientAction` | `clients/[id]/page.tsx` |
| Archive client | `archiveClient(id)` | `archiveClientServer(id)` â†’ calls `deleteClientAction` + refresh | `clients/page.tsx`, `clients/[id]/page.tsx` |

### Finance Module (3 critical fixes)

| Action | Current (Local-Only) | Required (Server-Backed) | Files |
|--------|---------------------|-------------------------|-------|
| Change invoice status | `updateInvoiceStatus(id, status)` | `updateInvoiceStatusServer(id, status)` (already exists in store!) | `finance/page.tsx`, `finance/invoices/[id]/page.tsx` |
| Edit line item | `updateLineItem(invId, liId, patch)` | Call `syncLineItemToServer` after each edit | `finance/invoices/[id]/page.tsx` |
| Recalculate totals | `recalcInvoice(id)` | Add server sync to persist `amount_cents` | `finance-store.ts` |

### Assets Module (2 critical fixes)

| Action | Current (Local-Only) | Required (Server-Backed) | Files |
|--------|---------------------|-------------------------|-------|
| Update asset status | `updateAssetStatus(id, status)` | Create `updateAssetStatusServer(id, status)` â†’ calls `updateAssetAction` | `fleet-grid.tsx`, `assets/[id]/page.tsx` |
| Assign/Unassign | `assignAsset(id, ...)` / `unassignAsset(id)` | Already wrapped in `toggleCustodyServer` â€” ensure all call sites use it | `assets-store.ts` |

---

## ðŸŸ  Warnings

- **[Integrations]** Local syncNow() still has setTimeout: The local-only syncNow() action still uses setTimeout(2000). Components use syncNowServer() instead, so this is dead code.

---

## ðŸŸ¢ Modules Fully Persisted

These modules correctly call server actions for ALL mutations:

### Schedule
- âœ… All mutations persist to server
- âœ… No mock data

### Team
- âœ… Member actions persist
- âœ… Permission toggles persist
- âœ… Invites persist
- âœ… No mock data

### Automations
- âœ… All flow actions persist
- âœ… New Flow creates DB record
- âœ… Test Flow uses server execution
- âœ… No mock data

### Integrations
- âœ… All connection actions persist
- âœ… Settings persist
- âœ… Stripe OAuth uses server
- âœ… No mock data

### Forms
- âœ… All template actions persist
- âœ… No mock data

### Inbox
- âœ… All inbox actions persist
- âœ… No mock data

---

## Priority Order for Fixes

1. **Jobs** â€” Most user-visible module. Every edit/delete is lost.

2. **Finance** â€” Invoice status changes (Send, Void, Mark Paid) are lost.

3. **Clients** â€” Tag additions and archives are lost.

4. **Assets** â€” Report Issue and status changes are lost.


---
_Report generated by iWorkr QA Audit System â€” Cross-Module Persistence Audit_