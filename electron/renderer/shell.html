<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iWorkr</title>
  <link rel="stylesheet" href="shell.css">
</head>
<body>
  <!-- macOS drag region -->
  <div id="titlebar">
    <div id="titlebar-drag"></div>
    <!-- Windows controls (hidden on macOS) -->
    <div id="win-controls">
      <button id="btn-minimize" aria-label="Minimize">
        <svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="currentColor"/></svg>
      </button>
      <button id="btn-maximize" aria-label="Maximize">
        <svg width="10" height="10" viewBox="0 0 10 10"><rect width="10" height="10" rx="1" fill="none" stroke="currentColor" stroke-width="1"/></svg>
      </button>
      <button id="btn-close" aria-label="Close">
        <svg width="10" height="10" viewBox="0 0 10 10"><line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1.2"/><line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1.2"/></svg>
      </button>
    </div>
  </div>

  <!-- Offline Banner -->
  <div id="offline-banner" class="hidden">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.56 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/>
    </svg>
    <span>Connection Lost. Offline Mode Active.</span>
  </div>

  <!-- Loading State -->
  <div id="shell-loading">
    <div id="shell-content">
      <!-- Logo -->
      <div id="logo-container">
        <div id="logo-glow"></div>
        <svg id="logo" width="64" height="64" viewBox="0 0 64 64" fill="none">
          <rect width="64" height="64" rx="16" fill="#0a0a0a"/>
          <rect x="1" y="1" width="62" height="62" rx="15" stroke="url(#border-gradient)" stroke-width="1" fill="none"/>
          <text x="32" y="42" text-anchor="middle" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" font-size="28" font-weight="700" fill="url(#text-gradient)">W</text>
          <defs>
            <linearGradient id="border-gradient" x1="0" y1="0" x2="64" y2="64">
              <stop offset="0%" stop-color="rgba(255,255,255,0.1)"/>
              <stop offset="100%" stop-color="rgba(255,255,255,0.02)"/>
            </linearGradient>
            <linearGradient id="text-gradient" x1="16" y1="16" x2="48" y2="48">
              <stop offset="0%" stop-color="#00E676"/>
              <stop offset="100%" stop-color="#00C853"/>
            </linearGradient>
          </defs>
        </svg>
      </div>

      <p id="loading-text">Loading workspace…</p>

      <!-- Spinner -->
      <div id="spinner">
        <div id="spinner-track"></div>
        <div id="spinner-fill"></div>
      </div>
    </div>

    <!-- Skeleton sidebar (immersion) -->
    <div id="skeleton-sidebar">
      <div class="skeleton-avatar"></div>
      <div class="skeleton-divider"></div>
      <div class="skeleton-item" style="width: 70%"></div>
      <div class="skeleton-item" style="width: 55%"></div>
      <div class="skeleton-item" style="width: 80%"></div>
      <div class="skeleton-item" style="width: 45%"></div>
      <div class="skeleton-divider"></div>
      <div class="skeleton-item" style="width: 60%"></div>
      <div class="skeleton-item" style="width: 75%"></div>
      <div class="skeleton-item" style="width: 50%"></div>
    </div>
  </div>

  <!-- Update Banner -->
  <div id="update-banner" class="hidden">
    <div id="update-content">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
      </svg>
      <span id="update-text">Update available</span>
    </div>
    <button id="update-action">Restart</button>
  </div>

  <script>
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    
    if (isMac) {
      document.getElementById('win-controls').style.display = 'none';
      document.body.classList.add('is-mac');
    } else {
      document.body.classList.add('is-win');
      document.getElementById('btn-minimize').addEventListener('click', () => window.iworkr?.window.minimize());
      document.getElementById('btn-maximize').addEventListener('click', () => window.iworkr?.window.maximize());
      document.getElementById('btn-close').addEventListener('click', () => window.iworkr?.window.close());
    }

    window.addEventListener('online', () => {
      document.getElementById('offline-banner').classList.add('hidden');
      document.body.classList.remove('ghost-mode');
      window.iworkr?.network.reportStatus(true);
    });

    window.addEventListener('offline', () => {
      document.getElementById('offline-banner').classList.remove('hidden');
      document.body.classList.add('ghost-mode');
      window.iworkr?.network.reportStatus(false);
    });

    if (window.iworkr) {
      window.iworkr.shell.onOffline(() => {
        document.getElementById('offline-banner').classList.remove('hidden');
        document.body.classList.add('ghost-mode');
        document.getElementById('loading-text').textContent = 'Working offline…';
      });

      window.iworkr.update.onDownloaded((info) => {
        const banner = document.getElementById('update-banner');
        document.getElementById('update-text').textContent = `v${info.version} ready to install`;
        banner.classList.remove('hidden');
      });

      document.getElementById('update-action').addEventListener('click', () => {
        window.iworkr.update.install();
      });
    }
  </script>
</body>
</html>
